!function e(t,r,i){function n(s,c){if(!r[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var d=r[s]={exports:{}};t[s][0].call(d.exports,function(e){var r=t[s][1][e];return n(r?r:e)},d,d.exports,e,t,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(e,t,r){"use strict";r.SCALE_SERVICE_UUID="00001820-0000-1000-8000-00805f9b34fb",r.SCALE_CHARACTERISTIC_UUID="00002a80-0000-1000-8000-00805f9b34fb",r.MAGIC1=223,r.MAGIC2=120,r.TABLE1=[0,118,132,80,219,228,111,178,250,251,77,79,142,87,140,95,158,174,176,181,93,150,21,185,15,252,253,112,27,128,187,244,147,254,255,105,104,131,207,167,210,235,60,100,65,119,198,134,203,211,221,72,238,240,30,88,76,138,143,164,2,75,6,36,141,183,191,40,99,173,184,86,137,160,196,81,197,82,39,61,201,214,220,66,44,215,230,239,249,53,217,188,122,31,67,108,54,56,7,148,152,216,227,182,83,63,12,146,154,194,209,213,52,29,98,169,32,126,172,9,94,89,49,156,163,151,179,116,193,237,242,16,46,74,225,35,43,129,247,97,25,8,26,57,101,62,115,59,123,11,103,4,106,34,70,14,85,102,84,1,69,107,50,139,171,24,186,204,212,38,226,231,28,68,20,149,153,133,218,78,110,224,232,55,190,243,127,223,246,248,45,48,33,19,23,13,22,37,91,51,17,92,124,135,161,189,5,144,159,166,109,180,199,202,195,18,3,229,222,233,155,136,47,234,236,200,41,113,73,90,114,71,125,162,165,145,175,177,10,205,96,192,157,120,206,208,121,58,170,168,42,64,241,117,245,130],r.TABLE2=[0,159,60,216,151,206,62,98,141,119,238,149,106,195,155,24,131,200,215,193,174,22,196,194,165,140,142,28,172,113,54,93,116,192,153,135,63,197,169,78,67,226,250,136,84,190,132,222,191,122,162,199,112,89,96,183,97,143,247,147,42,79,145,105,251,44,83,94,173,160,154,231,51,228,133,61,56,10,179,11,3,75,77,104,158,156,71,13,55,121,229,198,201,20,120,15,240,139,114,68,43,144,157,150,36,35,152,161,95,210,180,6,27,227,230,146,127,253,1,45,243,246,92,148,202,232,117,186,29,137,255,37,2,177,47,203,221,72,57,163,14,64,12,58,207,235,107,32,99,175,21,125,100,176,108,220,123,242,16,208,73,204,233,124,59,234,209,39,249,115,248,164,118,69,17,236,18,237,7,126,211,19,103,65,70,23,166,30,91,205,184,66,241,128,109,214,74,76,46,212,225,80,213,48,167,239,244,38,245,110,40,49,168,111,81,85,101,90,178,4,82,50,218,187,181,134,170,102,5,217,86,171,182,219,223,41,224,129,52,87,53,252,130,185,31,254,188,138,189,88,8,9,25,26,33,34]},{}],2:[function(e,t,r){"use strict";var i=function(){function e(){}return e.prototype.addEventListener=function(e,t){if(this.listeners_||(this.listeners_=Object.create(null)),e in this.listeners_){var r=this.listeners_[e];r.indexOf(t)<0&&r.push(t)}else this.listeners_[e]=[t]},e.prototype.removeEventListener=function(e,t){if(this.listeners_&&e in this.listeners_){var r=this.listeners_[e],i=r.indexOf(t);i>=0&&(1===r.length?delete this.listeners_[e]:r.splice(i,1))}},e.prototype.dispatchEvent=function(e){if(!this.listeners_)return!0;var t=this;e.__defineGetter__("target",function(){return t});var r=e.type,i=0;if(r in this.listeners_)for(var n=this.listeners_[r].concat(),o=0,s=void 0;s=n[o];o++)i|=s.handleEvent?s.handleEvent.call(s,e)===!1:s.call(this,e)===!1;return!i&&!e.defaultPrevented},e}();r.BTSEventTarget=i},{}],3:[function(e,t,r){"use strict";function i(){var e=m++;return m&=255,e}function n(e){m=255&e}function o(e,t,r){for(var i=0;i<e.byteLength;i++){var n=t[i]+r&255;e[i]=y.TABLE1[n]}}function s(e,t){for(var r=new Uint8Array(e.byteLength),i=0;i<e.byteLength;i++){var n=255&e[i];r[i]=y.TABLE2[n]-t&255}return r}function c(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return 255&t}function a(e,t,r){if(r.length>E)throw"payload too long: "+r.length;var n=new ArrayBuffer(8+r.length),s=new Uint8Array(n),a=i();s[0]=y.MAGIC1,s[1]=y.MAGIC2,s[2]=5+r.length,s[3]=e,s[4]=a,s[5]=t,s[6]=255&r.length;var h=new Uint8Array(n,7,r.length);o(h,r,a);var d=new Uint8Array(n,3,r.length+4);return s[7+r.length]=c(d),n}function h(e){var t=e.byteLength;if(t){var r=new Uint8Array(e);if(8>t)throw"data too short: "+t;if(r[0]!==y.MAGIC1&&r[1]!==y.MAGIC2)throw"don't have the magic";var i=r[2],n=new Uint8Array(e.slice(3,t-1)),o=c(n);if(r[t-1]!==o)throw"checksum mismatch "+r[t-1]+" !== "+o;var a=r[3],h=r[4],d=r[5],u=r[6];if(i!==t-3)throw"length mismatch 1 "+i+" !== "+(t-3);if(u!==t-8)throw"length mismatch 2";var l=new Uint8Array(e.slice(7,t-1)),v=s(l,h);return new w(a,d,v)}}function d(e,t,r){void 0===e&&(e=1),void 0===t&&(t=100),void 0===r&&(r=1);var i=[255&e,255&t,255&r];return a(4,0,i)}function u(){var e=[0,0];return a(12,0,e)}function l(){var e=[5];return a(12,0,e)}function v(){var e=[6];return a(12,0,e)}function f(){var e=[7];return a(12,0,e)}function p(e){void 0===e&&(e=20);var t=[8,255&e];return a(12,0,t)}function g(){return a(2,0,[])}var y=e("./constants"),E=10,m=0;r.setSequenceId=n;var w=function(){function e(e,t,r){if(this.type=e,this.id=t,this.payload=r,this.value=null,5===e){for(var i=((255&r[1])<<8)+(255&r[0]),n=0;n<r[4];n++)i/=10;2===(2&r[6])&&(i*=-1),this.value=i}}return e}();r.Message=w,r.decode=h,r.encodeWeight=d,r.encodeTare=u,r.encodeStartTimer=l,r.encodePauseTimer=v,r.encodeStopTimer=f,r.encodeGetTimer=p,r.encodeGetBattery=g},{"./constants":1}],4:[function(e,t,r){"use strict";var i=function(){function e(e){this.start=Date.now()/1e3,this.series=[],this.scale=e,this.recordCb=this.record.bind(this),this.record(),e.addEventListener("weightMeasured",this.recordCb)}return e.prototype.stop=function(){return this.record(),this.scale.removeEventListener("weightMeasured",this.recordCb),this.scale=null,this.recordCb=null,this.series},e.prototype.record=function(){var e=Date.now()/1e3-this.start;this.series.push([e,this.scale.weight])},e}();r.Recorder=i},{}],5:[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=e("./constants"),o=e("./event_target"),s=e("./recorder"),c=e("./packet"),a=function(e){function t(t){e.call(this),this.connected=!1,this.service=null,this.characteristic=null,this.weight=null,this.recorder=null,this.batteryCb=null,this.series=null,this.device=t,this.name=this.device.name,console.log("created scale for "+this.device.address+" ("+this.device.name+")")}return i(t,e),t.prototype.connect=function(){this.connected||(chrome.bluetoothLowEnergy.onServiceAdded.addListener(this.serviceAdded.bind(this)),chrome.bluetoothLowEnergy.onCharacteristicValueChanged.addListener(this.characteristicValueChanged.bind(this)),chrome.bluetoothLowEnergy.connect(this.device.address,{persistent:!0},this.deviceConnected.bind(this)))},t.prototype.deviceConnected=function(){return chrome.runtime.lastError?void console.log("connect failed: "+chrome.runtime.lastError.message):void chrome.bluetoothLowEnergy.getServices(this.device.address,this.servicesAdded.bind(this))},t.prototype.serviceAdded=function(e){e.uuid===n.SCALE_SERVICE_UUID&&(this.service||(this.service=e,chrome.bluetoothLowEnergy.getCharacteristics(this.service.instanceId,this.allCharacteristics.bind(this))))},t.prototype.servicesAdded=function(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];this.serviceAdded(r)}},t.prototype.characteristicValueChanged=function(e){var t=c.decode(e.value);if(!t)return void console.log("characteristic value update, but no message");if(5===t.type){var r=this.weight,i=this.weight!==t.value;this.weight=t.value;var n={detail:{value:t.value,previous:r}};this.dispatchEvent(new CustomEvent("weightMeasured",n)),i&&this.dispatchEvent(new CustomEvent("weightChanged",n))}else if(3===t.type){var o=this.batteryCb;this.batteryCb=null,o&&o(t.payload[0]/100)}else console.log("non-weight response"),console.log(t)},t.prototype.disconnect=function(){this.connected=!1,chrome.bluetoothLowEnergy.disconnect(this.device.address)},t.prototype.allCharacteristics=function(e){if(chrome.runtime.lastError)return void console.log("failed listing characteristics: "+chrome.runtime.lastError.message);for(var t=!1,r=0;r<e.length;r++)if(e[r].uuid===n.SCALE_CHARACTERISTIC_UUID){this.characteristic=e[r],t=!0;break}t?chrome.bluetoothLowEnergy.startCharacteristicNotifications(this.characteristic.instanceId,this.notificationsReady.bind(this)):(console.log("scale doesnt have required characteristic"),console.log(e))},t.prototype.notificationsReady=function(){chrome.runtime.lastError&&console.log("failed enabling characteristic notifications: "+chrome.runtime.lastError.message),console.log("scale ready"),this.connected=!0,this.poll(),setInterval(this.poll.bind(this),1e3),this.dispatchEvent(new CustomEvent("ready",{detail:{scale:this}}))},t.prototype.logError=function(){chrome.runtime.lastError&&console.log("bluetooth call failed: "+chrome.runtime.lastError.message)},t.prototype.tare=function(){if(!this.connected)return!1;var e=c.encodeTare();return chrome.bluetoothLowEnergy.writeCharacteristicValue(this.characteristic.instanceId,e,this.logError.bind(this)),!0},t.prototype.startTimer=function(){if(!this.connected)return!1;var e=c.encodeStartTimer();return chrome.bluetoothLowEnergy.writeCharacteristicValue(this.characteristic.instanceId,e,this.logError.bind(this)),!0},t.prototype.pauseTimer=function(){if(!this.connected)return!1;var e=c.encodePauseTimer();return chrome.bluetoothLowEnergy.writeCharacteristicValue(this.characteristic.instanceId,e,this.logError.bind(this)),!0},t.prototype.stopTimer=function(){if(!this.connected)return!1;var e=c.encodeStopTimer();return chrome.bluetoothLowEnergy.writeCharacteristicValue(this.characteristic.instanceId,e,this.logError.bind(this)),!0},t.prototype.getTimer=function(e){if(!this.connected)return!1;e||(e=1);var t=c.encodeGetTimer(e);return chrome.bluetoothLowEnergy.writeCharacteristicValue(this.characteristic.instanceId,t,this.logError.bind(this)),!0},t.prototype.getBattery=function(e){if(!this.connected)return!1;this.batteryCb=e;var t=c.encodeGetBattery();return chrome.bluetoothLowEnergy.writeCharacteristicValue(this.characteristic.instanceId,t,this.logError.bind(this)),!0},t.prototype.poll=function(){if(!this.connected)return!1;var e=c.encodeWeight();return chrome.bluetoothLowEnergy.writeCharacteristicValue(this.characteristic.instanceId,e,this.logError.bind(this)),!0},t.prototype.startRecording=function(){this.recorder||(this.recorder=new s.Recorder(this))},t.prototype.stopRecording=function(){return this.series=this.recorder.stop(),this.recorder=null,this.series},t}(o.BTSEventTarget);r.Scale=a},{"./constants":1,"./event_target":2,"./packet":3,"./recorder":4}],6:[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=e("./constants"),o=e("./event_target"),s=e("./scale"),c=navigator.bluetooth,a=function(e){function t(){e.call(this),this.ready=!1,this.devices={},this.scales=[],this.adapterState=null,this.failed=!1,console.log("new ScaleFinder")}return i(t,e),t.prototype.adapterStateChanged=function(e){if(chrome.runtime.lastError)return void console.log("adapter state changed: "+chrome.runtime.lastError.message);console.log("adapter state changed"),console.log(e);var t=!this.adapterState,r=this.adapterState&&this.adapterState.discovering!==e.discovering;if(this.adapterState=e,t&&this.dispatchEvent(new Event("ready")),r){var i=new CustomEvent("discoveryStateChanged",{detail:{discovering:e.discovering}});this.dispatchEvent(i)}},t.prototype.deviceAdded=function(e){if(e.uuids&&!(e.uuids.indexOf(n.SCALE_SERVICE_UUID)<0)){if(e.address in this.devices)return void console.log("WARN: device added that is already known "+e.address);var t=new s.Scale(e);this.devices[e.address]=t,this.scales.push(t)}},t.prototype.logDiscovery=function(){if(chrome.runtime.lastError){var e=chrome.runtime.lastError.message;console.log("Failed to frob discovery: "+e)}},t.prototype.startDiscovery=function(){if(!this.failed){var e=console.log.bind(console);c.requestDevice({filters:[{services:[n.SCALE_SERVICE_UUID]}]}).then(function(t){return e("> Found "+t.name),e("Connecting to GATT Server..."),t.connectGATT()}).then(function(t){return e("Getting Battery Service..."),t.getPrimaryService(n.SCALE_SERVICE_UUID)}).then(function(t){return e("Getting Battery Level Characteristic..."),t.getCharacteristic(n.SCALE_CHARACTERISTIC_UUID)}).then(function(t){return e("Reading Battery Level..."),t.readValue()}).then(function(t){var r=new DataView(t),i=r.getUint8(0);e("> Battery Level is "+i+"%")})["catch"](function(t){e("Argh! "+t),e(t)})}},t.prototype.stopDiscovery=function(){this.failed||chrome.bluetooth.stopDiscovery(this.logDiscovery)},t}(o.BTSEventTarget);r.ScaleFinder=a,"undefined"!=typeof window&&(window.ScaleFinder=a)},{"./constants":1,"./event_target":2,"./scale":5}]},{},[6]);